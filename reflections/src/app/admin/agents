async def get_agent_summaries(conn):
    rows = await conn.fetch("""
        WITH last_ref AS (
          SELECT
            r.companion_id,
            MAX(r.created_at) AS last_seen,
            COUNT(*)          AS total_refs,
            COALESCE(SUM(r.gic_awarded), 0) AS total_gic
          FROM reflections r
          GROUP BY r.companion_id
        )
        SELECT
          c.id::text           AS companion_id,
          c.name               AS name,
          c.archetype          AS archetype,
          u.id::text           AS user_id,
          COALESCE(l.total_refs, 0) AS reflections,
          COALESCE(l.total_gic, 0)  AS gic,
          EXTRACT(EPOCH FROM (NOW() - COALESCE(l.last_seen, c.created_at)))::bigint AS since_last_seconds
        FROM companions c
        JOIN users u ON u.id = c.user_id
        LEFT JOIN last_ref l ON l.companion_id = c.id
        ORDER BY COALESCE(l.last_seen, c.created_at) DESC
        LIMIT 500;
    """)

    out = []
    for r in rows:
        out.append({
           "companion_id": "uuid",
           "name": "Echo",
           "archetype": "sage",
           "user_id": "uuid",
           "reflections": 42,
           "gic": 580,
           "since_last": "12m 10s"
        })

```
    return out  
